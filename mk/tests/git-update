#! /bin/sh
. "${0%/*}/test.subr"

set_up_package "git-update.mk"
set_up_repository git

step "Testing Git before a remote update"
package_make patch

assert_that --file "$wrkdir/pkgbase/today" --has-content "2018-03-01"

step "Testing Git after a remote update"
cd "$repoworkdir"
scm_git_commit "2022-03-01"
package_make clean
package_make patch

# The working copy of the package has been updated to reflect the remote
# change.
assert_that --file "$wrkdir/pkgbase/today" --has-content "2022-03-01"
# TODO: The archive in ${DISTDIR} should be updated, but it isn't.


step "Testing Git after a remote update"
package_make clean
package_make patch

# The working copy of the package has been updated to reflect the remote
# change.
assert_that --file "$wrkdir/pkgbase/today" --has-content "2022-03-01"
