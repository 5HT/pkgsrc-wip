During make build:

>> SIPing 3 files...
>> /usr/pkg/bin/python3.9 -c from sipbuild.tools.build import main; main(); --verbose --no-make --qmake /usr/pkg/qt5/bin/qmake
>> Querying qmake about your Qt installation...
>> /usr/pkg/qt5/bin/qmake -query
>> These bindings will be built: pictureflow.
>> Generating the pictureflow bindings...
>> -c: Unable to find file "QtWidgets/QtWidgetsmod.sip"

We do have that file, in /usr/pkg/share/sip3.9/PyQt5/QtWidgets/QtWidgetsmod.sip.
This setting likely needs to be adjusted to the new way of sipping/building:
MAKE_ENV+=		SIP_DIR=${BUILDLINK_PREFIX.py-sip}/share/sip${PYVERSSUFFIX}

    (the message comes from sip-6.5.0/code_generator/metasrc/lexer.l; adding a directory to includeDirList somehow might help. The value may come from a call to set_globals. That is called in /sipbuild/builder.py with sip_include_dirs.

    Project() has an option called sip_include_dirs.

    Maybe baking the path into sip6 or pyqtbuild is the thing to do.

Next error:

>> SIPing 3 files...
>> /usr/pkg/bin/python3.9 -c from sipbuild.tools.build import main; main(); --verbose --no-make --qmake /usr/pkg/qt5/bin/qmake
>> Querying qmake about your Qt installation...
>> /usr/pkg/qt5/bin/qmake -query
>> These bindings will be built: pictureflow.
>> Generating the pictureflow bindings...
>> -c: Q_PID is undefined

I son't see where it is used, but it seems to be defined in

/usr/pkg/share/sip3.9/PyQt5/QtCore/qprocess.sip:typedef void *Q_PID;
/usr/pkg/share/sip3.9/PyQt5/QtCore/qprocess.sip:typedef qint64 Q_PID;
/usr/pkg/share/sip3.9/PyQt5/QtCore/qprocess.sip:    Q_PID pid() const;

Moving that file aside gives an error that it isn't found, so it is included
from somewhere.
Commenting out the 3rd line makes the build work.
The first two are conditional defines; 
It seems that %If (WS_X11 || WS_MACX) isn't matching.


Next error:

$ calibre
Traceback (most recent call last):
  File "/usr/pkg/bin/calibre", line 21, in <module>
    sys.exit(calibre())
  File "/usr/pkg/lib/calibre/calibre/gui_launch.py", line 64, in calibre
    main(args)
  File "/usr/pkg/lib/calibre/calibre/gui2/main.py", line 533, in main
    app, opts, args = init_qt(args)
  File "/usr/pkg/lib/calibre/calibre/gui2/main.py", line 124, in init_qt
    app = Application(args, override_program_name=override, windows_app_uid=MAIN_APP_UID)
  File "/usr/pkg/lib/calibre/calibre/gui2/__init__.py", line 915, in __init__
    from calibre_extensions import progress_indicator
RuntimeError: the sip module implements API v12.0 to v12.7 but the progress_indicator module requires API v12.9

https://bbs.archlinux.org/viewtopic.php?id=271344 was somewhat informative.

Does that mean that py39-qt5 also needs to be built with sip6 somehow?
Or py39-sip-qt5-4.19.25 needs to be updated? There is talk of a version
12.9.0-1. But that version makes no sense since the latest is 6.x.
(However it does match the API versions mentioned above)

Or that calibre's use of sip6 needs to be replaced with sip4?
Or is it using a wrong sip implementation somewhere?

$ python3.9 -c "import PyQt5.sip as ps; print(ps.__file__)"
/usr/pkg/lib/python3.9/site-packages/PyQt5/sip.so

There is a
https://files.pythonhosted.org/packages/3b/27/fd81188a35f37be9b3b4c2db1654d9439d1418823916fe702ac3658c9c41/PyQt5-5.15.6.tar.gz;
maybe this version uses sip6? 5.15.5 uses sip4.

Try using sip5 instead of sip6.

Next problem: "Bad database location '...'. Will start with a new. emtpy calibre library".

Traceback (most recent call last):
  File "/usr/pkg/lib/calibre/calibre/gui2/main.py", line 330, in initialize_db
    db = LibraryDatabase(self.library_path)
  File "/usr/pkg/lib/calibre/calibre/db/legacy.py", line 188, in __init__
    backend = self.backend = create_backend(library_path, default_prefs=default_prefs,
  File "/usr/pkg/lib/calibre/calibre/db/legacy.py", line 45, in create_backend
    return DB(library_path, default_prefs=default_prefs,
  File "/usr/pkg/lib/calibre/calibre/db/backend.py", line 462, in __init__
    if self.user_version == 0:
  File "/usr/pkg/lib/calibre/calibre/db/backend.py", line 1213, in user_version
    return self.conn.get('pragma user_version;', all=False)
  File "/usr/pkg/lib/calibre/calibre/db/backend.py", line 926, in conn
    self._conn = Connection(self.dbpath)
  File "/usr/pkg/lib/calibre/calibre/db/backend.py", line 341, in __init__
    plugins.load_apsw_extension(self, 'sqlite_extension')
  File "/usr/pkg/lib/calibre/calibre/constants.py", line 325, in load_apsw_extension
    conn.enableloadextension(True)
AttributeError: 'Connection' object has no attribute 'enableloadextension'

ebook-viewer works, though.
